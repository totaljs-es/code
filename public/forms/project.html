<div data---="largeform__common.form__if:projectsform;icon:ti ti-code-branch;width:660;reload:projectsform/reload;autofocus:1;submit:projectsform/submit" class="hidden">
	<div data-scope="projectsform">
		<div data-bind="?.disablepath__disabled .C__hidden .H">
			<div class="padding">
				<div data-bind="?.disablepathsync__disabled .D__hidden .E">
					<div class="row">
						<div class="col-sm-6 m">
							<div data---="input__?.path__required:true__'/www/www/'" class="C">@(Path)</div>
							<div class="help H">
								<span class="link exec" data-exec="?/autocomplete"><i class="ti ti-search"></i>@(Browse server)</span>. @(The path for external projects must be in the form:) <b>external://@(projectname)</b>
							</div>
						</div>
						<div class="col-sm-6 m">
							<div data---="input__?.pathsync__maxlength:100__''" class="D">@(Path for synchronization)</div>
							<div class="help E"><span class="link exec" data-exec="?/autocomplete2"><i class="ti ti-search"></i>@(Browse)</span>. @(Additional path for e.g. production)</div>
						</div>
					</div>
				</div>

				<div data-bind="?.isexternal__show" class="bg-smoke padding m hidden fs12">
					<i class="ti ti-question-circle mr5"></i><a href="https://github.com/totaljs/framework4/blob/master/helpers/index.js#L19" target="_blank" class="gray">@(How to enable editing source code for the external Total.js project?)</a>
				</div>

				<hr class="nmt" />

				<!--
				<div data-bind="?.isexternal__show" class="bg-smoke padding m hidden">
					<div data---="input__?.token__maxlength:50__''">@(Token)</div>
					<div class="help"><span class="link exec" data-exec="?/securitytoken"><i class="ti ti-key"></i>@(Generate)</span>. @(A security token for the external project)</div>
				</div>-->

				<div class="row">
					<div class="col-sm-6 m">
						<div data---="input__?.name__required:true;maxlength:300__''">@(Name)</div>
					</div>
					<div class="col-sm-6 m">
						<div data---="input__?.url__required:true;maxlength:300__''" class="C">@(URL to application)</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6 m">
						<div data---="input__?.documentation__placeholder:https://docs.totaljs.com__'https://docs.totaljs.com'">@(Documentation URL)</div>
					</div>
					<div class="col-sm-6 m">
						<div data---="input__?.support__placeholder:https://messenger.totaljs.com__'https://messenger.totaljs.com'">@(Support URL)</div>
					</div>
				</div>

				<div class="row">
					<div class="col-sm-6 m">
						<div data---="input__?.repository__placeholder:cms__''">@(Folder name)</div>
						<div class="help">@(Electron version of Code app can store files locally in this folder name.)</div>
					</div>
					<div class="col-sm-6 m">
						<div data---="input__?.logfile__maxlength:100__''">@(A path to log file)</div>
						<div class="help">@(A default log file is <code>current_app_dir/logs/debug.log</code>)</div>
					</div>
				</div>

				<div data---="input__?.hostnames__placeholder:www.domain1.com, www.domain2.com__''">@(Hostnames)</div>
				<div class="help m">@(It works only in the Docker engine and can listen on multiple hostnames defined above. Host names must be separated by commas.)</div>

				<hr class="nmt" />
				<div data---="checkbox__?.pinned__null__false">@(Pin the project on top)</div>
				<div data---="checkbox__?.hidden__null__false" class="b">@(Hide project)</div>
				<hr />
				<div data---="checkbox__?.backup__null__true">@(Backup all modified files)</div>
				<div data---="checkbox__?.skiptmp__null__true">@(Skip <b>tmp</b> directory)</div>
				<div data---="checkbox__?.skipsrc__null__true">@(Skip <b>.src</b> directory)</div>
				<div data---="checkbox__?.skipfs__null__false">@(Skip all <b>FileStorage</b> directories)</div>
				<div data---="checkbox__?.skipnm__null__true">@(Skip <b>node_modules</b> directory)</div>
				<div data---="checkbox__?.allowbundle__null__true">@(Allow bundle making)</div>
				<hr />
				<div data---="checkbox__?.releasemode__null__false">@(<b>Docker:</b> enable release mode)</div>
				<div data---="checkbox__?.customdocker__null__false">@(<b>Docker:</b> enable custom docker-compose.yaml)</div>
				<div data-bind="?.customdocker__enabled .D">
					<div data---="checkbox__?.dockerlogs__null__false" class="D">@(<b>Docker:</b> use logs directly from the docker container)</div>
				</div>
				<div style="margin-top:13px">
					<div data---="input__?.certname__placeholder:@(Optional, e.g. apps.yourdomain.com);maxlength:300__''">@(Custom SSL certificate name)</div>
					<div class="help">@(Enter a domain name e.g. <b>apps.yourdomain.com</b>. Docker will use an SSL certificate in the form <b>/proxy/data/certs/apps.yourdomain.com.(csr|key)</b>, etc..)</div>
				</div>
				<hr />
				<div data---="checkbox__?.servicemode__null__true">@(Enable service mode)</div>
				<div data---="checkbox__?.allowlivereload__null__false">@(Allow live reload)</div>
				<div data---="checkbox__?.allowscripts__null__false">@(Allow scripts)</div>
			</div>
			<hr class="nmt nmb" />
			<div class="padding">
				<h3><i class="ti ti-users"></i>@(Users and permissions)</h3>
				<div data---="selectbox__?.users__if:!value.sa;datasource:%projectsformusers;text:id__[]"></div>
				<div class="help m">@(Choose users which can have access to this project)</div>
				<div data---="textarea__?.permissions__height:100;monospace:true;placeholder:@(userid \: path)__''">@(Permissions)</div>
				<div class="help m">@(Define permissions for the users. Path starting with <code>^</code> will disable the access.)</div>
				<div data---="input__?.reference__null__''" class="D">@(Custom project reference)</div>
			</div>
			<div data-bind="?.id__show" class="hidden">
				<hr class="nmt nmb" />
				<div class="padding">
					<h3><i class="ti ti-chart-bar"></i>@(Internal stats)</h3>
					<div data---="checkbox__?.resetcombo__null__false">@(Reset combo scoreboard)</div>
					<div data---="checkbox__?.resettime__null__false">@(Reset time spent)</div>
					<div data---="checkbox__?.resetchangelog__null__false">@(Reset changelog)</div>
				</div>
			</div>
		</div>
	</div>
	<nav data---="validation__projectsform">
		<button name="submit" disabled="disabled"><i class="ti ti-save mr5"></i>@(SAVE)</button>
		<button name="cancel">@(Cancel)</button>
	</nav>
</div>

<script>
	PLUGIN('projectsform', function(exports) {

		exports.autocomplete = function(el) {
			if (common.cloud)
				return;
			projectsform.path && AJAX('GET /api/common/directories/', { path: projectsform.path }, function(response) {
				SETTER('suggestion/show', 'left', el, response, function(value) {
					SET('projectsform.path @change', value.path);
				}, 0, 5);
			});
		};

		exports.autocomplete2 = function(el) {
			if (common.cloud)
				return;
			projectsform.pathsync && AJAX('GET /api/common/directories/', { path: projectsform.pathsync }, function(response) {
				SETTER('suggestion/show', 'left', el, response, function(value) {
					SET('projectsform.pathsync', value.path);
				}, 0, 5);
			});
		};

		exports.reload = function(com) {
			var model = GET('projectsform');
			AJAX('GET /api/users/', '%projectsformusers');
			com.reconfigure({ title: model.id ? '@(Edit project)' : '@(New project)' });
			SET('?.disablepath', (common.cloud || model.id) ? true : false);
			SET('?.disablepathsync', !!common.cloud);
		};

		exports.securitytoken = function() {
			SET('?.token', GUID(25));
		};

		exports.submit = function() {
			var data = CLONE(GET('projectsform @reset'));
			AJAX('POST /api/projects/ @showloading ERROR', data, function(response) {

				SETTER('loading/hide');

				if (response.success) {

					if (W.code && W.code.data && data.id === W.code.data.id)
						EXEC('code/refresh');

					SET('common.form', '');
					SETTER('notifybar/success', '@(The project has been saved successfully.)');
					EXEC('projects/refresh');
				} else
					SET('projectsform.response', response);
			});
		};

		exports.search = function(com) {
			SETTER('autocomplete', 'attach', com, function(q, render) {
				AJAX('GET /api/admin/users/search/', { q: q }, render);
			}, function(value, input) {
				var index = projectsform.users.findIndex('userid', value.id);
				if (index === -1)
					PUSH2('projectsform.users', { username: value.name, userid: value.id });
				input.component().set('');
			}, 0, 2);
		};

		WATCH('?.path', function(path, value) {

			var isexternal = value ? value.substring(0, 11) === 'external://' : false;

			if (value && value !== '/www/www/' && (/_|-/).test(value) && !isexternal) {

				var index = value.lastIndexOf('/');
				if (index === -1)
					index = value.lastIndexOf('\\');

				if (!projectsform.name)
					SET('?.name', value.substring(index + 1));

				if (!projectsform.url) {
					var arr = value.substring(index + 1).replace(/_/g, '.').split('-');
					arr.reverse();
					SET('?.url', 'https://' + arr.join('.'));
				}

			} else if (!isexternal) {
				var index = value.substring(8).indexOf('/');
				SET('?.url', value.substring(0, index));
			}

			SET('?.isexternal', isexternal);
		});

	});
</script>